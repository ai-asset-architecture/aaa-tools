# v0.5 Closing Protocol (Complete-Milestone)

Date: 2026-01-22
Status: Draft

## Goal
將里程碑「完成」轉為系統事件：驗證通過即自動觸發結案，產出證據、更新定義並重新索引。

## Scope
- Runbook: `ops/complete-milestone`
- Target: `aaa-tpl-docs/docs/milestones/*` 與 `aaa-tpl-docs/reports/milestones/*`
- Trigger: 驗證通過後自動執行並通知人類

## Inputs
- `milestone_id` (e.g., `v0.5`)
- `approver` (e.g., `@architect`)
- `definition_path` (e.g., `aaa-tpl-docs/docs/milestones/v0.5-modular-runtime.md`)

## Closing Steps (Verify → Evidence → Definition → Index → Notify)
1. **Verify**: 執行指定驗證套件與 runbook/schema 驗證，產出 `verification_hash` 與 `logs_path`。
2. **Evidence**: 產生 `reports/milestones/<id>_completion.md`，包含驗證摘要、`verification_hash`、`definition_hash`。
3. **Definition**: 更新 `definition_path` frontmatter：
   - `status: Completed`
   - `completed_at: <timestamp>`
   - `verification_hash: <hash>`
   - `definition_hash: <hash>`
4. **Index**: 重新執行 `governance.update_index` 於 `docs/milestones` 與 `reports/milestones`。
5. **Notify**: 通知人類並附上 Evidence/Definition hash 與報告路徑。

## Bi-directional Anchoring
- Evidence 內紀錄 Definition Hash → 確保報告對應當下規格版本。
- Definition 內紀錄 Verification Hash → 確保規格與驗證證據雙向鎖定。

## Success Criteria
- 驗證成功後可自動產生完成報告並更新定義狀態。
- 報告與定義包含互相可追溯的 hash。
- 索引同步更新，避免孤兒檔案與清單落差。
